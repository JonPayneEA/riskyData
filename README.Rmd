---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# riskyData! <img src="logo.png" align="right" alt="" width="120"/>

<!-- badges: start -->

[![License: GNU General Public License](https://img.shields.io/badge/license-GNU%20General%20Public%20License-blue.svg)](https://cran.r-project.org/web/licenses/GNU%20General%20Public%20License) [![](https://img.shields.io/github/languages/code-size/JonPayneEA/HydroEnR.svg)](https://github.com/JonPayneEA/HydroEnR)

<!-- badges: end -->

## Introduction

This package is part of the fleet of `flode` tools designed for members of Evidence and Risk. This package, `riskyData`, is used to interact with the EAs API. Hydrometric data can be pulled using in built functions. Data are stored in containers that implement strict quality controls. Data can be interrogated using a range of inbuilt tools.

## Installation

You can install the development version of riskyData from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("JonPayne88/riskyData")
```

## Example 1 - compile daily flow statistics

```{r example}
library(riskyData)

## Import the Bewdley dataset
data(bewdley)

## Using a pipe calculate the hydrological year and then calculate statistics
bewdley$hydroYearDay()$dayStats(plot = TRUE)
```


## Example 2 - Use run length encoding to seperate rainfall events

```{r rainsep1}
## Import the Chesterton rain gauge data
data(chesterton)

## Calculate rain seperation use RLE, minimum total event must be at least 2mm
rainSep(dateTime = chesterton$data$dateTime,
        precip = chesterton$data$value,
        threshold = 0,
        minTotal = 2,
        roll = 0)
```

These can be integrated into plots;

```{r rainsep2}
## Plot the base data
plot(chesterton$data$dateTime[34000:44000], chesterton$data$value[34000:44000],
     ylim = rev(range(chesterton$data$value[30000:40000], na.rm = TRUE)),
    type = 'h', ylab = "Rainfall (mm)", xlab = "Date Time")

## Calculate the rain profiles using a 5hr aggregation
dayRain <- rainSep(dateTime = chesterton$data$dateTime[34000:44000],
                   precip = chesterton$data$value[34000:44000],
                   threshold = 0,
                   minTotal = 2,
                   roll = 20)

## Plot the identified windows
for (i in seq_along(dayRain$id)){
 polygon(x = c(dayRain$start[i], dayRain$start[i], dayRain$end[i],
               dayRain$end[i]),
         y = c(0, 12, 12, 0),
         col = scales::alpha('red', 0.5),
         border = NA)
}

## Overlay the original rainfall for clarity
lines(chesterton$data$dateTime[34000:44000], chesterton$data$value[34000:44000])
```
