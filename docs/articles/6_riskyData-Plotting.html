<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="riskyData">
<title>riskyData-Plotting • riskyData</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="riskyData-Plotting">
<meta property="og:description" content="riskyData">
<meta property="og:image" content="https://jonpayneea.github.io/riskyData/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">riskyData</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/1_riskyData-Welcome.html">riskyData-Welcome</a>
    <a class="dropdown-item" href="../articles/2_riskyData-Containers.html">riskyData-Containers</a>
    <a class="dropdown-item" href="../articles/3_riskyData-Methods.html">riskyData-Methods</a>
    <a class="dropdown-item" href="../articles/4_riskyData-Ratings.html">riskyData-Ratings</a>
    <a class="dropdown-item" href="../articles/5_riskyData-Realtime.html">riskyData-Realtime data</a>
    <a class="dropdown-item" href="../articles/6_riskyData-Plotting.html">riskyData-Plotting</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JonPayneEA/riskyData/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>riskyData-Plotting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JonPayneEA/riskyData/blob/HEAD/vignettes/6_riskyData-Plotting.Rmd" class="external-link"><code>vignettes/6_riskyData-Plotting.Rmd</code></a></small>
      <div class="d-none name"><code>6_riskyData-Plotting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-data-visualisation-in-riskydata">Introduction to data visualisation in riskyData<a class="anchor" aria-label="anchor" href="#introduction-to-data-visualisation-in-riskydata"></a>
</h2>
<div class="section level4">
<h4 id="plotting-with-riskydata">Plotting with riskyData!<a class="anchor" aria-label="anchor" href="#plotting-with-riskydata"></a>
</h4>
<p>The package <code>riskyData</code> has very simple methods for
plotting hydrometric data, simply use the <code>$plot()</code> function.
The metadata that is associated with the imported data will quickly
specify the types of plots required. This limits the amount of
additional arguments required.</p>
<p>All plots are generated with ggplot2. This is an implementation of
Leland Wilkinson’s Grammar of Graphics — a general scheme for data
visualization which breaks up graphs into semantic components such as
scales and layers and are stored in a list. Their positions in the list
determine the plotting order when generating the graphical output.
ggplot2 serves as a replacement for the base graphics and contains a
number of defaults for web and print display of common scales. A
critical element of <code>riskyData</code> is the OOP that underpins the
package, using ggplot further adds to this functionality as plotting
objects can be stored and modified, rather than direct exporting.</p>
<p>Plots are currently associated with the formats useful for E&amp;R
forecasting, additional themes will be added soon.</p>
</div>
<div class="section level3">
<h3 id="loading-the-data">Loading the data<a class="anchor" aria-label="anchor" href="#loading-the-data"></a>
</h3>
<p>For the purpose of this we will import the Bewdley flow and
Chesterton rain gauge data sets</p>
<p>All plotting is organised around hydrological years. Use the
<code>$hydroYearDay()</code> function in any pipelines.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bewdley</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">chesterton</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Convert to hydrological year and day</span></span>
<span><span class="va">bewdley</span><span class="op">$</span><span class="fu">hydroYearDay</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calculating hydrological year and day<span style="color: #00BB00;">✔</span> Calculating hydrological year and day <span style="color: #B2B2B2;">[8.2s]</span></span>[39m</span>
<span><span class="va">chesterton</span><span class="op">$</span><span class="fu">hydroYearDay</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Calculating hydrological year and day<span style="color: #00BB00;">✔</span> Calculating hydrological year and day <span style="color: #B2B2B2;">[7.4s]</span></span>[39m</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="standard-plots">Standard plots<a class="anchor" aria-label="anchor" href="#standard-plots"></a>
</h3>
<p>For flow and level stations, when you apply the <code>$plot()</code>
function the plots are faceted by hydrological year and default to a
line based geometry.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bewdley</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/baseplot_flow-1.png" width="672"></p>
<p>For rainfall stations, when you apply the <code>$plot()</code>
function the plots are also faceted by hydrological year but default to
a column based geometry.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chesterton</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/baseplot_rain-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="viewing-the-whole-series">Viewing the whole series<a class="anchor" aria-label="anchor" href="#viewing-the-whole-series"></a>
</h3>
<p>For all types of gauges, you can view an unfaceted plot if you apply
the wrap argument as FALSE. The basic geometries of lines for level and
flow plots and bars/columns for rainfall sites will be retained.</p>
<p>If you wish to remove the title, set the title argument to FALSE.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bewdley</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>wrap <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>             title <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/baseplot_unwrap-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="cumulative-rainfall">Cumulative rainfall<a class="anchor" aria-label="anchor" href="#cumulative-rainfall"></a>
</h3>
<p>It is sometimes useful to view rainfall using a cumulative sum. With
<code>riskyData</code> these can be applied unwrapped or wrapped. If
wrap is set as TRUE, the cumulative plots are calculated for each
hydrological year.</p>
<p>To set a cumulative plot set cumul to TRUE.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chesterton</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>wrap <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                cumul <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/cumul_unwrap-1.png" width="672"></p>
<p>To calculate and plot cumulative rainfall by hydrological year set
wrap to TRUE.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chesterton</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>wrap <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                cumul <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/cumul_wrap-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="customising-your-plots">Customising your plots<a class="anchor" aria-label="anchor" href="#customising-your-plots"></a>
</h3>
<p>As the plots can be stored as objects, this enables us to add extra
information to them. As mentioned above the objects are stored as lists,
to add extra details we can modify the objects as you would any other
ggplot2 object.</p>
<p>In the example below I want to add threshold lines to the bewdley
flow data that is not faceted. Additionally I wish to set the theme to
linedraw and facet the plot so that there are 4 columns.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Set threshold examples</span></span>
<span><span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">400</span>, <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Store plot as object</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">bewdley</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>wrap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">## Modify plot</span></span>
<span><span class="va">plot</span> <span class="op">+</span> <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">thresholds</span>, </span>
<span>                  colour <span class="op">=</span> <span class="st">'red'</span>,</span>
<span>                  linetype <span class="op">=</span> <span class="st">'dashed'</span>,</span>
<span>                  linewidth <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">hydroYear</span>, </span>
<span>             scales <span class="op">=</span> <span class="st">'free_x'</span>, </span>
<span>             ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_linedraw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/threshold-1.png" width="672"></p>
<p>If we wished to plot the peaks detected by the
<code>$findPeaks()</code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bewdley</span><span class="op">$</span><span class="fu">findPeaks</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate hydrological year and day of peaks - used in faceting</span></span>
<span><span class="va">bewdley</span><span class="op">$</span><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span><span class="va">bewdley</span><span class="op">$</span><span class="va">peaks</span>, </span>
<span>                                        <span class="fu"><a href="../reference/hydroYearDay.html">hydroYearDay</a></span><span class="op">(</span><span class="va">bewdley</span><span class="op">$</span><span class="va">peaks</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="va">bewdley</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>wrap <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">bewdley</span><span class="op">$</span><span class="va">peaks</span>, </span>
<span>                  inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">dateTime</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, </span>
<span>                  colour <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">hydroYear</span>, scales <span class="op">=</span> <span class="st">'free_x'</span><span class="op">)</span></span></code></pre></div>
<p><img src="6_riskyData-Plotting_files/figure-html/peaks-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonathan Payne, Oliver Dyer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
